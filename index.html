<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>kilna | Kurumsal Lüks Kimlik ve AI Logo Referans Sistemi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400;1,500&family=Space+Mono&family=Manrope:wght@200;300;400;500;600;700;800&family=Comfortaa:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Manrope', 'sans-serif'], 
                        serif: ['Cormorant Garamond', 'serif'],
                        mono: ['Space Mono', 'monospace'],
                        brand: ['Comfortaa', 'cursive'], 
                    },
                    colors: {
                        brand: {
                            black: '#0D0D0D',
                            gray: '#888888',
                            light: '#F4F4F4',
                            clay: '#C18C74',
                            paper: '#F9F7F2', 
                            gold: '#B8860B',
                            platinum: '#E5E4E2'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        :root { --page-width: 210mm; --page-height: 297mm; }
        body { background-color: #0a0a0a; color: #121212; -webkit-print-color-adjust: exact !important; scroll-behavior: smooth; }
        #book-container { width: var(--page-width); margin: 60px auto; background: white; box-shadow: 0 100px 200px rgba(0,0,0,1); }
        .page {
            width: var(--page-width);
            height: var(--page-height);
            background: white;
            position: relative;
            overflow: hidden;
            page-break-after: always;
            break-after: page;
        }
        .grid-layout { display: grid; grid-template-columns: repeat(12, 1fr); grid-column-gap: 6mm; padding: 30mm; height: 100%; position: relative; z-index: 10; }
        .page-num { position: absolute; bottom: 15mm; right: 30mm; font-family: 'Space Mono', monospace; font-size: 8pt; color: #121212; opacity: 0.3; }
        .chapter-mark {
            position: absolute; top: 30mm; left: 12mm; font-family: 'Space Mono', monospace; font-size: 7pt; 
            text-transform: uppercase; letter-spacing: 4px; writing-mode: vertical-rl; transform: rotate(180deg); opacity: 0.2;
        }
        .ai-container { position: relative; background-color: #f1f1f1; overflow: hidden; border: 1px solid rgba(0,0,0,0.05); }
        .ai-image { width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: opacity 2s cubic-bezier(0.4, 0, 0.2, 1); }
        .ai-image.loaded { opacity: 1; }
        .ai-placeholder {
            position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: #999; font-family: 'Space Mono', monospace; font-size: 7px; text-align: center; padding: 30px;
        }

        /* Logo Yükleme Arayüzü */
        .logo-upload-zone {
            border: 1px dashed rgba(255,255,255,0.2);
            transition: all 0.3s ease;
        }
        .logo-upload-zone:hover {
            border-color: #C18C74;
            background: rgba(193, 140, 116, 0.05);
        }

        @media screen { .page { margin-bottom: 50px; } }
        @media print {
            body { background: none; margin: 0; padding: 0; }
            #book-container { margin: 0; box-shadow: none; width: 100%; }
            .no-print { display: none !important; }
            .page { border: none; }
            @page { size: A4; margin: 0; }
        }
    </style>
</head>
<body>

    <!-- KURUMSAL UI KONTROL PANELİ -->
    <div class="fixed top-8 right-8 z-50 no-print flex flex-col gap-6 items-end">
        <div class="bg-brand-black text-white p-8 rounded-3xl shadow-2xl border border-white/10 w-[420px] backdrop-blur-2xl bg-opacity-95">
            <div class="flex justify-between items-start mb-6">
                <div>
                    <h3 class="font-bold text-xs tracking-[0.4em] uppercase text-brand-clay mb-1">kilna MARKASI İŞLETİM SİSTEMİ</h3>
                    <p class="text-[9px] text-gray-500 font-mono">ULTRA PREMIUM ÜRETİM v3.0</p>
                </div>
                <div class="flex flex-col items-end">
                    <span id="progress-val" class="text-[10px] font-mono text-brand-clay">SİSTEM HAZIR</span>
                    <div class="w-24 bg-white/5 h-1 mt-2 rounded-full overflow-hidden">
                        <div id="progress-bar" class="bg-brand-clay h-full w-0 transition-all duration-700"></div>
                    </div>
                </div>
            </div>

            <!-- Logo Referans Yükleme -->
            <div class="mb-8">
                <label class="block text-[8px] font-bold uppercase tracking-[0.3em] text-gray-400 mb-3">AI İÇİN LOGO REFERANSI</label>
                <div id="drop-zone" class="logo-upload-zone rounded-2xl p-4 flex flex-col items-center justify-center cursor-pointer relative min-h-[100px]">
                    <input type="file" id="logo-input" class="hidden" accept="image/*">
                    <div id="logo-preview" class="hidden w-16 h-16 mb-2 rounded-lg overflow-hidden bg-white/5 p-2 border border-white/10">
                        <img src="" id="logo-img-preview" class="w-full h-full object-contain">
                    </div>
                    <div id="upload-prompt" class="text-center">
                        <svg class="w-6 h-6 mb-2 mx-auto text-gray-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>
                        <p class="text-[9px] text-gray-500 uppercase tracking-widest">Sürükle veya Dosya Seç</p>
                    </div>
                </div>
                <p class="text-[8px] text-gray-600 mt-2 italic leading-tight">* Yüklenen logo, AI tarafından görsellere profesyonel baskı teknikleriyle yerleştirilecektir.</p>
            </div>
            
            <button id="btn-generate" onclick="startGeneration()" class="w-full bg-brand-clay hover:bg-white hover:text-brand-black transition-all duration-700 font-bold text-xs py-5 rounded-2xl flex items-center justify-center gap-4 group shadow-xl">
                <span id="gen-text">ASSET ÜRETİMİNİ BAŞLAT (LOGO-REF)</span>
                <div id="gen-spinner" class="hidden w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
            </button>
            
            <div class="grid grid-cols-2 gap-4 mt-6">
                <button onclick="window.scrollTo({top: 0, behavior:'smooth'})" class="border border-white/10 hover:bg-white/5 py-4 rounded-xl text-[10px] font-bold uppercase tracking-widest transition-all">SİTE HARİTASI</button>
                <button id="btn-pdf" onclick="exportPDF()" class="bg-white text-black hover:bg-brand-clay hover:text-white py-4 rounded-xl text-[10px] font-bold uppercase tracking-widest transition-all flex items-center justify-center gap-2">
                    <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                    PDF DIŞA AKTAR
                </button>
            </div>
        </div>
    </div>

    <div id="book-container">
        <!-- SAYFALAR BURAYA GELECEK -->
    </div>

    <script>
        const apiKey = ""; 
        const container = document.getElementById('book-container');
        let pageCounter = 1;
        let logoBase64 = null;

        // --- Logo Yükleme Mantığı ---
        const logoInput = document.getElementById('logo-input');
        const dropZone = document.getElementById('drop-zone');
        const logoPreview = document.getElementById('logo-preview');
        const logoImgPreview = document.getElementById('logo-img-preview');
        const uploadPrompt = document.getElementById('upload-prompt');

        dropZone.onclick = () => logoInput.click();
        logoInput.onchange = (e) => {
            const file = e.target.files[0];
            if (file) handleLogoFile(file);
        };

        function handleLogoFile(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                logoBase64 = e.target.result.split(',')[1];
                logoImgPreview.src = e.target.result;
                logoPreview.classList.remove('hidden');
                uploadPrompt.classList.add('hidden');
            };
            reader.readAsDataURL(file);
        }

        // --- Görsel Yardımcılar ---
        const emblemSvg = (color = "currentColor", size = "200") => `
            <svg width="${size}" height="${size}" viewBox="0 0 100 100" fill="none">
                <circle cx="50" cy="50" r="45" stroke="${color}" stroke-width="0.2" stroke-dasharray="2 4" />
                <circle cx="50" cy="50" r="38" stroke="${color}" stroke-width="0.4" />
                <circle cx="50" cy="50" r="28" stroke="${color}" stroke-width="1" opacity="0.6" />
                <circle cx="50" cy="50" r="18" stroke="${color}" stroke-width="2" opacity="0.4" />
                <circle cx="50" cy="50" r="5" fill="${color}" />
            </svg>
        `;

        const aiImg = (prompt, ratio = "aspect-square") => `
            <div class="ai-container ${ratio} w-full overflow-hidden rounded-sm">
                <div class="ai-placeholder">
                    <span class="mb-2 opacity-30 uppercase tracking-[0.4em] text-[7px]">Lüks Görsel Sentez Motoru</span>
                    <span class="opacity-10 text-[6px] italic px-16 leading-relaxed">${prompt}</span>
                </div>
                <img data-prompt="${prompt}" class="ai-image" />
            </div>
        `;

        const renderPage = (chapter, content, options = {}) => {
            const page = document.createElement('div');
            page.className = `page ${options.bg || ''} ${options.className || ''}`;
            page.innerHTML = `
                ${options.hideMark ? '' : `<div class="chapter-mark ${options.dark ? 'text-white/20' : 'text-black/20'}">${chapter}</div>`}
                <div class="grid-layout">
                    <div class="col-span-12 h-full flex flex-col">
                        ${content}
                    </div>
                </div>
                ${options.hideNum ? '' : `<div class="page-num ${options.dark ? 'text-white/20' : 'text-black/20'}">${pageCounter.toString().padStart(2, '0')}</div>`}
            `;
            container.appendChild(page);
            pageCounter++;
        };

        const createSectionDivider = (num, title, sub) => {
            renderPage(num, `
                <div class="h-full flex flex-col justify-center -m-[30mm] p-[30mm] bg-brand-black text-white relative">
                    <div class="absolute inset-0 opacity-[0.03] scale-150 pointer-events-none">${emblemSvg("#FFFFFF", "100%")}</div>
                    <span class="font-mono text-xs text-brand-clay tracking-[0.6em] mb-8 uppercase">${num}</span>
                    <h2 class="font-serif italic text-9xl mb-12 leading-[0.8] tracking-tighter">${title}</h2>
                    <p class="font-sans text-2xl opacity-40 max-w-lg border-l-2 border-white/10 pl-10 ml-2 leading-relaxed">${sub}</p>
                </div>
            `, { dark: true, hideMark: true, hideNum: true });
        };

        // --- KILAVUZ İNŞASI ---
        const buildBible = () => {
            // 00. KAPAK
            renderPage('KAPAK', `
                <div class="h-full flex flex-col items-center justify-center text-center relative bg-brand-paper -m-[30mm]">
                    <div class="absolute inset-0 opacity-[0.04] pointer-events-none">${emblemSvg("#121212", "120%")}</div>
                    <div class="z-10 px-24">
                        <div class="mb-20 border border-brand-clay/30 rounded-full px-16 py-4 font-mono text-[10px] uppercase tracking-[0.6em] text-brand-clay inline-block">Enterprise Kimlik Protokolü v.3.0</div>
                        <h1 class="font-brand font-bold text-[240px] leading-[0.7] lowercase text-brand-black tracking-tighter mb-12">kilna</h1>
                        <p class="font-serif italic text-[52px] text-brand-black/60 tracking-tight leading-none mb-40">Kusurlu güzelliğin sanatı.</p>
                        <div class="grid grid-cols-3 w-full max-w-4xl text-[9px] font-mono uppercase tracking-[0.5em] opacity-30 border-t border-black/5 pt-12">
                            <div>Logo-Referans Motoru</div><div>Lüks Konumlandırma</div><div>Global Ajans Standartları</div>
                        </div>
                    </div>
                </div>
            `, { hideMark: true, hideNum: true });

            // 01. STRATEJİ
            createSectionDivider('BÖLÜM 01', 'Marka <br>Stratejisi', 'DNA, Pazar Konumlandırması ve Persona Mimarisi.');

            renderPage('01. STRATEJİ', `
                <h3 class="font-serif italic text-6xl mb-16">Marka DNA'sı ve Felsefesi</h3>
                <div class="grid grid-cols-2 gap-24">
                    <div class="space-y-16">
                        <div>
                            <h4 class="font-bold text-xs uppercase tracking-widest text-brand-clay mb-6">Marka Özü</h4>
                            <p class="text-2xl font-serif italic text-gray-800 leading-relaxed">"Sessiz Lüks: Toprağın sabırlı sessizliği ve zanaatkarın zamansız dokunuşu."</p>
                        </div>
                        <div>
                            <h4 class="font-bold text-xs uppercase tracking-widest text-brand-clay mb-6">Konumlandırma Matrisi</h4>
                            <p class="text-sm text-gray-600 leading-relaxed mb-8">Kilna, "Hızlı Tüketim" ve "Geleneksel Sanat" arasındaki boşluğu, modern lüks minimalizmle doldurur. Ürün bir nesne değil, bir ritüeldir.</p>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="p-6 bg-gray-50 border border-gray-100"><span class="block font-mono text-[8px] mb-2 uppercase tracking-widest">Premium</span><p class="text-[10px]">Kalite Odaklı</p></div>
                                <div class="p-6 bg-brand-black text-white"><span class="block font-mono text-[8px] mb-2 uppercase tracking-widest">Luxury</span><p class="text-[10px]">Ruh Odaklı</p></div>
                            </div>
                        </div>
                    </div>
                    <div>
                        ${aiImg("Extreme macro shot of a single ceramic plate edge, high detail glaze texture, moody museum lighting, black background", "aspect-[3/4]")}
                    </div>
                </div>
            `);

            // 02. PERSONA
            renderPage('01. STRATEJİ', `
                <h3 class="font-serif italic text-6xl mb-16">Persona Mimarisi</h3>
                <div class="grid grid-cols-2 gap-10">
                    <div class="p-12 bg-gray-50 border border-gray-100 rounded-3xl">
                        <h4 class="font-bold text-[10px] uppercase tracking-widest mb-6 text-brand-clay">01 / Aspirational Koleksiyoner</h4>
                        <p class="text-sm italic font-serif text-gray-600 mb-8">"Nesnelerin ruhuna yatırım yapar, hikaye anlatıcılığını mülkiyetten üstün tutar."</p>
                        <div class="space-y-4 font-mono text-[9px] opacity-60">
                            <div class="flex justify-between border-b pb-2"><span>Yaşam Tarzı</span><span>Tasarım Odaklı</span></div>
                            <div class="flex justify-between border-b pb-2"><span>Dijital Yolculuk</span><span>Kürate Edilmiş Feed</span></div>
                        </div>
                    </div>
                    <div class="p-12 border border-gray-100 rounded-3xl">
                        <h4 class="font-bold text-[10px] uppercase tracking-widest mb-6 text-brand-clay">02 / Fonksiyonel Tasarım Mimarı</h4>
                        <p class="text-sm italic font-serif text-gray-600 mb-8">"Mekanı şekillendirirken dokunsal değerler arar. Teknik kusursuzluk bekler."</p>
                        <div class="space-y-4 font-mono text-[9px] opacity-60">
                            <div class="flex justify-between border-b pb-2"><span>Yaşam Tarzı</span><span>Yapısalcı Minimalizm</span></div>
                            <div class="flex justify-between border-b pb-2"><span>Dijital Yolculuk</span><span>Spesifikasyon Odaklı</span></div>
                        </div>
                    </div>
                </div>
                <div class="mt-10">${aiImg("Minimalist luxury interior with ceramic collection displayed on a floating shelf, natural lighting", "aspect-video")}</div>
            `);

            // 03. GÖRSEL KİMLİK YÖNETİŞİMİ
            createSectionDivider('BÖLÜM 02', 'Görsel <br>Kimlik', 'Logo Mühendisliği, Yönetişim ve Görsel Dil Standartları.');

            renderPage('02. KİMLİK', `
                <h3 class="font-serif italic text-6xl mb-16">Logo Yönetişim Sistemi</h3>
                <div class="grid grid-cols-12 gap-10">
                    <div class="col-span-8 bg-gray-50 p-24 rounded-3xl flex items-center justify-center relative border border-dashed border-gray-200">
                        <span class="absolute top-8 left-8 font-mono text-[9px] opacity-30 uppercase tracking-widest">Ana Logo Ünitesi</span>
                        <div class="flex flex-col items-center">
                            <div class="mb-12 opacity-40">${emblemSvg("#121212", "120")}</div>
                            <h2 class="font-brand font-bold text-[140px] lowercase leading-none tracking-tighter">kilna</h2>
                        </div>
                    </div>
                    <div class="col-span-4 space-y-10">
                        <div class="bg-brand-black p-12 rounded-3xl text-white text-center">
                            <span class="font-brand font-bold text-4xl lowercase">kilna</span>
                            <p class="text-[8px] font-mono mt-4 opacity-50 uppercase tracking-widest">Negatif Kullanım</p>
                        </div>
                        <div class="border border-gray-100 p-12 rounded-3xl text-center">
                            <span class="font-brand font-bold text-3xl lowercase border border-black px-4 py-2 rounded-full">k</span>
                            <p class="text-[8px] font-mono mt-4 opacity-50 uppercase tracking-widest">Monogram İkonu</p>
                        </div>
                        <div class="p-12 bg-brand-clay rounded-3xl text-white text-center">
                             <div class="scale-50">${emblemSvg("#FFFFFF", "80")}</div>
                             <p class="text-[8px] font-mono mt-2 opacity-50 uppercase tracking-widest">Sadece Amblem</p>
                        </div>
                    </div>
                </div>
            `);

            // 04. TASARIM SİSTEMİ (DESIGN SYSTEM)
            createSectionDivider('BÖLÜM 03', 'Enterprise <br>UI Tasarım', 'Design Tokens, Bileşen Kütüphanesi ve Etkileşim Çerçevesi.');

            renderPage('03. UI SİSTEMİ', `
                <h3 class="font-serif italic text-6xl mb-16">Tasarım Token Mimarisi</h3>
                <div class="grid grid-cols-3 gap-8">
                    <div class="ui-token">
                        <span class="text-brand-clay block mb-4 uppercase tracking-widest">RENK TOKENLARI</span>
                        <div class="space-y-2">
                            <div class="flex justify-between items-center"><div class="w-8 h-8 bg-brand-black rounded"></div><span>$marka-siyah</span></div>
                            <div class="flex justify-between items-center"><div class="w-8 h-8 bg-brand-clay rounded"></div><span>$marka-kil</span></div>
                        </div>
                    </div>
                    <div class="ui-token">
                        <span class="text-brand-clay block mb-4 uppercase tracking-widest">BOŞLUK TOKENLARI</span>
                        <div class="space-y-2">
                            <div class="flex justify-between items-center"><div class="h-1 bg-gray-200 w-4"></div><span>$boşluk-xs / 4px</span></div>
                            <div class="flex justify-between items-center"><div class="h-1 bg-gray-200 w-16"></div><span>$boşluk-lg / 24px</span></div>
                        </div>
                    </div>
                    <div class="ui-token">
                        <span class="text-brand-clay block mb-4 uppercase tracking-widest">MOTION TOKENLARI</span>
                        <div class="space-y-2 italic opacity-50">
                            <p>$gecis-yavas: 700ms</p>
                            <p>$easing-luxury: cubic-bezier</p>
                        </div>
                    </div>
                </div>
                <div class="mt-20">
                    <h4 class="font-bold text-xs uppercase mb-12 tracking-widest border-b pb-4">Ölçeklenebilir Bileşen Kütüphanesi</h4>
                    <div class="grid grid-cols-2 gap-20">
                        <div class="space-y-12">
                            <div class="flex flex-col gap-4">
                                <span class="font-mono text-[8px] opacity-40 uppercase tracking-widest">BUTONLAR / VARYANTLAR</span>
                                <button class="bg-brand-black text-white py-5 px-12 text-[10px] font-bold uppercase tracking-[0.3em] hover:bg-brand-clay transition-all">Ritüele Ekle</button>
                                <button class="border border-brand-black py-5 px-12 text-[10px] font-bold uppercase tracking-[0.3em] hover:bg-gray-50 transition-all">Hikayeyi Keşfet</button>
                            </div>
                        </div>
                        <div class="space-y-12">
                            <div class="flex flex-col gap-4">
                                <span class="font-mono text-[8px] opacity-40 uppercase tracking-widest">INPUTLAR / ETKİLEŞİM</span>
                                <div class="border-b-2 border-black pb-2 text-2xl font-serif italic text-gray-400 italic">Parçanı ara...</div>
                            </div>
                        </div>
                    </div>
                </div>
            `);

            // 05. AMBALAJ VE FİZİKSEL SİSTEMLER
            createSectionDivider('BÖLÜM 04', 'Fiziksel <br>Sistemler', 'Ambalaj Mimarisi, Baskı Teknikleri ve Unboxing Ritüeli.');

            renderPage('04. FİZİKSEL', `
                <h3 class="font-serif italic text-6xl mb-16">Ambalaj Mühendisliği</h3>
                <div class="grid grid-cols-2 gap-16 h-[120mm]">
                    <div class="space-y-12">
                        ${aiImg("Luxury ceramic packaging mockup, debossed black logo on textured stone-white paper, gold foil details", "aspect-square")}
                        <div class="p-10 bg-brand-paper border-l-4 border-brand-clay">
                            <h4 class="font-bold text-xs mb-4 uppercase tracking-widest">Baskı Şartnamesi</h4>
                            <ul class="text-[10px] space-y-3 font-mono opacity-60 uppercase tracking-tighter">
                                <li>- Kağıt: GF Smith Extract / Moon</li>
                                <li>- İşlem: Derin Gofre + Altın Varak</li>
                                <li>- Doku: Ham Keten Bitiş</li>
                            </ul>
                        </div>
                    </div>
                    <div class="flex flex-col justify-center space-y-12">
                        <div class="p-12 border border-gray-100 rounded-3xl">
                            <h4 class="font-serif italic text-3xl mb-4">Unboxing Ritüeli</h4>
                            <p class="text-sm opacity-60 leading-relaxed">Paket açılışı, müşterinin markayla kurduğu en mahrem fiziksel temas anıdır. Koku, doku ve ses (kağıdın hışırtısı) bir bütün olarak tasarlanmıştır.</p>
                        </div>
                        ${aiImg("Top down photo of a ceramic care card inside a gift box, wax seal detail, premium linen paper", "aspect-video")}
                    </div>
                </div>
            `);

            // TEKNİK EKLER (100 SAYFA MİMARİSİ SİMÜLASYONU)
            for(let i=0; i<88; i++) {
                if(i % 20 === 0 && i !== 0) {
                     renderPage('EK REHBER', `
                        <div class="h-full flex flex-col justify-center items-center text-center border-y border-black/5 p-20">
                            <span class="font-mono text-[10px] text-brand-clay mb-10 uppercase tracking-[0.6em]">ÜRETİM ŞARTNAMESİ / CİLT 0${Math.floor(i/20)}</span>
                            <h2 class="font-serif italic text-7xl mb-6">Asset Belirtim <br>Endeksi</h2>
                            <div class="w-12 h-px bg-brand-clay mb-12"></div>
                            <div class="grid grid-cols-4 gap-4 w-full opacity-10">
                                ${Array(8).fill('<div class="h-1 bg-gray-500 rounded-full"></div>').join('')}
                            </div>
                        </div>
                    `, { hideMark: true, hideNum: true });
                } else {
                    renderPage('ŞARTNAME', `
                        <div class="flex justify-between items-end border-b border-black pb-4 mb-10">
                            <h3 class="font-sans font-bold text-[10px] uppercase tracking-[0.3em] text-brand-clay">No: K-UX-${3000 + i}</h3>
                            <span class="font-mono text-[7px] opacity-30 uppercase tracking-widest">Global Marka Standardı</span>
                        </div>
                        <div class="grid grid-cols-2 gap-16 h-[120mm]">
                            <div class="space-y-8">
                                <h4 class="font-serif italic text-3xl leading-tight">Uygulama Alanı: ${['E-Posta İmzası', 'Araç Giydirme', 'Mağaza Tabelası', 'Personel Kartı', 'Sergi Standı'][i % 5]}</h4>
                                <div class="bg-gray-100 rounded-3xl p-12 h-64 flex items-center justify-center relative overflow-hidden group">
                                     <div class="absolute inset-0 opacity-[0.03] scale-150">${emblemSvg()}</div>
                                     <div class="w-full h-full border border-dashed border-gray-300 flex items-center justify-center font-mono text-[6px] opacity-20 uppercase tracking-widest text-center px-10">TEKNİK TASLAK<br>MİMARİ GRID SİSTEMİ</div>
                                </div>
                                <p class="text-[10px] text-gray-500 leading-relaxed font-sans">Bu sayfa, kurumsal kimliğin fiziksel uygulama standartlarını (Figma & Adobe Üretime Hazır) tanımlar. Global ajans standartlarında vektörel hazırlık gerektirir.</p>
                            </div>
                            <div class="space-y-6">
                                ${aiImg("Luxury branding application mockup for " + ['corporate branding', 'delivery vehicle', 'exterior signage', 'staff badges', 'digital dashboard'][i % 5], "aspect-square")}
                                <div class="bg-brand-paper p-8 rounded-2xl border border-gray-100">
                                     <span class="font-mono text-[8px] font-bold uppercase block mb-2 text-brand-clay">YÖNETİŞİM PROTOKOLÜ:</span>
                                     <p class="text-[9px] italic text-gray-600 leading-relaxed italic">Tasarım rasyoneli, Tornanın Merkezkaç yasasına sadık kalarak, her zaman merkezden dışa doğru genişlemelidir.</p>
                                </div>
                            </div>
                        </div>
                    `, { hideMark: (i > 10) });
                }
            }

            // BİTİŞ
            renderPage('SON', `
                <div class="h-full flex flex-col items-center justify-center text-center -m-[30mm] bg-brand-black text-white relative">
                    <div class="absolute top-[30mm] opacity-5 scale-150">${emblemSvg("#FFFFFF", "500")}</div>
                    <h2 class="font-brand font-bold text-[140px] lowercase mb-16 tracking-tighter">kilna</h2>
                    <div class="w-32 h-px bg-brand-clay mb-16"></div>
                    <p class="font-mono text-sm tracking-[1em] text-gray-500 uppercase">Her şey merkezden başlar.</p>
                    <div class="mt-60 text-[9px] font-mono text-gray-700 uppercase tracking-widest opacity-40">© 2026 KILNA GLOBAL MARKA YÖNETİŞİMİ. TÜM HAKLARI SAKLIDIR.</div>
                </div>
            `, { hideMark: true, hideNum: true, dark: true });
        };

        // --- ÜRETİM MOTORLARI ---

        async function exportPDF() {
            const element = document.getElementById('book-container');
            const btn = document.getElementById('btn-pdf');
            if (!btn || !element) return;

            btn.innerText = "İŞLENİYOR...";
            btn.disabled = true;

            const opt = {
                margin: 0,
                filename: 'kilna-enterprise-marka-rehberi-v3.pdf',
                image: { type: 'jpeg', quality: 1.0 },
                html2canvas: { scale: 1.5, useCORS: true, logging: false },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
                pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
            };

            try {
                await html2pdf().set(opt).from(element).save();
                btn.innerText = "DIŞA AKTARMA TAMAM";
            } catch (err) {
                console.error("PDF Hatası:", err);
                btn.innerText = "HATA OLUŞTU";
            } finally {
                setTimeout(() => { btn.innerText = "PDF İNDİR"; btn.disabled = false; }, 2000);
            }
        }

        async function fetchWithRetry(prompt, maxRetries = 5) {
            const isLogoRef = !!logoBase64;
            const model = isLogoRef ? 'gemini-2.5-flash-image-preview' : 'imagen-4.0-generate-001';
            
            const enhancedPrompt = isLogoRef 
                ? `Yüklenen logoyu resmi marka logosu olarak kullan. Şu objenin lüks bir ürün çekimini yap: ${prompt}. Logoyu objenin yüzeyine veya arka plana, profesyonel bir marka uygulaması (gofre, baskı veya oyma) gibi kusursuzca yerleştir. Stil: Minimalist, wabi-sabi, derin gölgeli aydınlatma.`
                : prompt;

            for (let i = 0; i < maxRetries; i++) {
                try {
                    let response;
                    if (isLogoRef) {
                        const payload = {
                            contents: [{
                                parts: [
                                    { text: enhancedPrompt },
                                    { inlineData: { mimeType: "image/png", data: logoBase64 } }
                                ]
                            }],
                            generationConfig: { responseModalities: ['TEXT', 'IMAGE'] }
                        };
                        response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`, {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify(payload),
                        });
                    } else {
                        response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${model}:predict?key=${apiKey}`, {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({ instances: [{ prompt: enhancedPrompt }], parameters: { sampleCount: 1 } }),
                        });
                    }

                    if (response.ok) return await response.json();
                    if (response.status === 429) await new Promise(r => setTimeout(r, Math.pow(2, i) * 1000));
                } catch (e) {
                    if (i === maxRetries - 1) return null;
                    await new Promise(r => setTimeout(r, Math.pow(2, i) * 1000));
                }
            }
            return null;
        }

        async function startGeneration() {
            const btn = document.getElementById('btn-generate');
            const spinner = document.getElementById('gen-spinner');
            const text = document.getElementById('gen-text');
            const progressBar = document.getElementById('progress-bar');
            const progressVal = document.getElementById('progress-val');
            const images = document.querySelectorAll('img[data-prompt]');
            
            if (!btn || !spinner || !text || !progressBar || !progressVal) return;

            btn.disabled = true;
            spinner.classList.remove('hidden');
            text.innerText = logoBase64 ? "LOGO REFERANS ALINIYOR..." : "VARLIKLAR ÜRETİLİYOR...";

            let completed = 0;
            for (const img of images) {
                const prompt = img.getAttribute('data-prompt');
                try {
                    const data = await fetchWithRetry(prompt);
                    let base64 = null;
                    
                    if (logoBase64) {
                        base64 = data.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;
                    } else {
                        base64 = data?.predictions?.[0]?.bytesBase64Encoded;
                    }

                    if (base64) {
                        img.src = `data:image/png;base64,${base64}`;
                        img.onload = () => {
                            img.classList.add('loaded');
                            if (img.previousElementSibling) img.previousElementSibling.style.display = 'none';
                        };
                    }
                } catch (e) { console.warn("Asset Hatası:", e); }
                completed++;
                const perc = Math.floor((completed / images.length) * 100);
                progressBar.style.width = `${perc}%`;
                progressVal.innerText = `%${perc} TAMAMLANDI`;
            }

            spinner.classList.add('hidden');
            text.innerText = "ÜRETİM TAMAMLANDI";
            btn.disabled = false;
        }

        window.onload = buildBible;
    </script>
</body>
</html>
