<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>kilna | 16:9 Kurumsal Lüks Kimlik & AI Tasarım Sistemi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400;1,500&family=Space+Mono&family=Manrope:wght@200;300;400;500;600;700;800&family=Comfortaa:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Manrope', 'sans-serif'], 
                        serif: ['Cormorant Garamond', 'serif'],
                        mono: ['Space Mono', 'monospace'],
                        brand: ['Comfortaa', 'cursive'], 
                    },
                    colors: {
                        brand: {
                            black: '#0D0D0D',
                            gray: '#888888',
                            light: '#F4F4F4',
                            clay: '#C18C74',
                            paper: '#F9F7F2', 
                            gold: '#B8860B'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        :root { 
            --page-width: 320mm; /* 16:9 Presentation Width */
            --page-height: 180mm; /* 16:9 Presentation Height */
        }
        body { background-color: #0d0d0d; color: #121212; -webkit-print-color-adjust: exact !important; scroll-behavior: smooth; }
        
        #book-container { width: var(--page-width); margin: 60px auto; background: white; box-shadow: 0 100px 200px rgba(0,0,0,1); }

        .page {
            width: var(--page-width);
            height: var(--page-height);
            background: white;
            position: relative;
            overflow: hidden;
            page-break-after: always;
            break-after: page;
        }

        .grid-layout { display: grid; grid-template-columns: repeat(12, 1fr); grid-column-gap: 8mm; padding: 25mm; height: 100%; position: relative; z-index: 10; }
        .page-num { position: absolute; bottom: 12mm; right: 25mm; font-family: 'Space Mono', monospace; font-size: 8pt; color: #121212; opacity: 0.3; }
        
        .chapter-mark {
            position: absolute; top: 12mm; left: 12mm; font-family: 'Space Mono', monospace; font-size: 7pt; 
            text-transform: uppercase; letter-spacing: 4px; opacity: 0.2;
        }

        .ai-container { position: relative; background-color: #f5f5f5; overflow: hidden; border: 1px solid rgba(0,0,0,0.03); }
        .ai-image { width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: opacity 2s ease; }
        .ai-image.loaded { opacity: 1; }
        .ai-placeholder {
            position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: #bbb; font-family: 'Space Mono', monospace; font-size: 8px; text-align: center; padding: 20px;
        }

        /* Logo Upload UI */
        .dashboard {
            background: rgba(13, 13, 13, 0.98);
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-blur: 24px;
        }
        .upload-zone {
            border: 1px dashed rgba(193, 140, 116, 0.4);
            transition: all 0.4s ease;
        }
        .upload-zone:hover { border-color: #C18C74; background: rgba(193, 140, 116, 0.05); }

        @media screen { .page { margin-bottom: 60px; } }
        @media print {
            body { background: none; margin: 0; padding: 0; }
            #book-container { margin: 0; box-shadow: none; width: var(--page-width); height: var(--page-height); }
            .no-print { display: none !important; }
            .page { border: none; width: var(--page-width); height: var(--page-height); }
            @page { size: landscape; margin: 0; }
        }
    </style>
</head>
<body>

    <!-- CONTROL CENTER -->
    <div class="fixed top-8 right-8 z-50 no-print flex flex-col gap-6 items-end">
        <div class="dashboard text-white p-8 rounded-[32px] shadow-2xl w-[400px]">
            <div class="flex justify-between items-start mb-8">
                <div>
                    <h3 class="font-bold text-xs tracking-[0.4em] uppercase text-brand-clay mb-1">kilna OS</h3>
                    <p class="text-[9px] text-gray-500 font-mono">ULTIMATE PRESENTATION v3.0</p>
                </div>
                <div id="progress-indicator" class="flex flex-col items-end opacity-0 transition-opacity">
                    <span id="progress-val" class="text-[9px] font-mono text-brand-clay">0%</span>
                    <div class="w-20 bg-white/5 h-1 mt-2 rounded-full overflow-hidden">
                        <div id="progress-bar" class="bg-brand-clay h-full w-0 transition-all duration-500"></div>
                    </div>
                </div>
            </div>

            <!-- Logo Reference Dropzone -->
            <div class="mb-8">
                <label class="block text-[8px] font-bold uppercase tracking-[0.3em] text-gray-400 mb-3">MARKA LOGOSU REFERANSI (Opsiyonel)</label>
                <div id="drop-zone" class="upload-zone rounded-2xl p-6 flex flex-col items-center justify-center cursor-pointer relative min-h-[120px]">
                    <input type="file" id="logo-input" class="hidden" accept="image/*">
                    <div id="logo-preview" class="hidden w-20 h-20 mb-2 rounded-lg overflow-hidden bg-white/5 p-3 border border-white/10">
                        <img src="" id="logo-img-preview" class="w-full h-full object-contain">
                    </div>
                    <div id="upload-prompt" class="text-center">
                        <svg class="w-8 h-8 mb-2 mx-auto text-brand-clay/40" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>
                        <p class="text-[10px] text-gray-400 uppercase tracking-widest">Logo Yükle</p>
                    </div>
                </div>
            </div>
            
            <button id="btn-generate" onclick="startGeneration()" class="w-full bg-brand-clay hover:bg-white hover:text-brand-black transition-all duration-500 font-bold text-xs py-5 rounded-2xl flex items-center justify-center gap-4 shadow-xl shadow-brand-clay/10">
                <span id="gen-text">ÜRETİMİ BAŞLAT (AI)</span>
                <div id="gen-spinner" class="hidden w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
            </button>
            
            <div class="grid grid-cols-2 gap-4 mt-6">
                <button onclick="window.print()" class="border border-white/10 hover:bg-white/5 py-4 rounded-xl text-[10px] font-bold uppercase tracking-widest transition-all">Yazdır</button>
                <button id="btn-pdf" onclick="exportPDF()" class="bg-white text-black hover:bg-brand-clay hover:text-white py-4 rounded-xl text-[10px] font-bold uppercase tracking-widest transition-all flex items-center justify-center gap-2">
                    <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                    PDF İNDİR
                </button>
            </div>
        </div>
    </div>

    <div id="book-container">
        <!-- Sunum sayfaları JS ile eklenecek -->
    </div>

    <script>
        const apiKey = ""; 
        const book = document.getElementById('book-container');
        let pageCounter = 1;
        let logoBase64 = null;

        // Logo Upload Handlers
        const logoInput = document.getElementById('logo-input');
        const dropZone = document.getElementById('drop-zone');
        const logoPreview = document.getElementById('logo-preview');
        const logoImgPreview = document.getElementById('logo-img-preview');
        const uploadPrompt = document.getElementById('upload-prompt');

        dropZone.onclick = () => logoInput.click();
        logoInput.onchange = (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    logoBase64 = e.target.result.split(',')[1];
                    logoImgPreview.src = e.target.result;
                    logoPreview.classList.remove('hidden');
                    uploadPrompt.classList.add('hidden');
                };
                reader.readAsDataURL(file);
            }
        };

        const emblemSvg = (color = "currentColor", size = "200") => `
            <svg width="${size}" height="${size}" viewBox="0 0 100 100" fill="none">
                <circle cx="50" cy="50" r="45" stroke="${color}" stroke-width="0.2" stroke-dasharray="2 4" />
                <circle cx="50" cy="50" r="38" stroke="${color}" stroke-width="0.4" />
                <circle cx="50" cy="50" r="28" stroke="${color}" stroke-width="0.8" opacity="0.6" />
                <circle cx="50" cy="50" r="18" stroke="${color}" stroke-width="1.2" opacity="0.4" />
                <circle cx="50" cy="50" r="4" fill="${color}" />
            </svg>
        `;

        const renderPage = (chapter, content, options = {}) => {
            const page = document.createElement('div');
            page.className = `page ${options.bg || ''} ${options.className || ''}`;
            page.innerHTML = `
                ${options.hideMark ? '' : `<div class="chapter-mark ${options.dark ? 'text-white/20' : 'text-black/20'}">${chapter}</div>`}
                <div class="grid-layout">
                    ${content}
                </div>
                ${options.hideNum ? '' : `<div class="page-num ${options.dark ? 'text-white/20' : 'text-black/20'}">${pageCounter.toString().padStart(2, '0')}</div>`}
            `;
            book.appendChild(page);
            pageCounter++;
        };

        const aiImg = (prompt, ratio = "aspect-video") => `
            <div class="ai-container ${ratio} w-full rounded-sm">
                <div class="ai-placeholder">
                    <span class="mb-2 opacity-30 uppercase tracking-[0.4em] text-[7px]">Visual Synthesis Engine</span>
                    <span class="opacity-10 text-[6px] italic px-24 leading-relaxed">${prompt}</span>
                </div>
                <img data-prompt="${prompt}" class="ai-image" />
            </div>
        `;

        // --- SUNUM İÇERİK MİMARİSİ ---

        const initPresentation = () => {
            // P01: ULTIMATE COVER
            renderPage('KAPAK', `
                <div class="col-span-12 h-full flex flex-col items-center justify-center text-center relative -m-[25mm] bg-brand-paper">
                    <div class="absolute inset-0 opacity-[0.04] pointer-events-none flex items-center justify-center">${emblemSvg("#121212", "120%")}</div>
                    <div class="z-10 px-40">
                        <div class="mb-16 border border-brand-clay/30 rounded-full px-12 py-3 font-mono text-[10px] uppercase tracking-[0.5em] text-brand-clay inline-block">Brand Guidelines 2026</div>
                        <h1 class="font-brand font-bold text-[240px] leading-[0.75] lowercase text-brand-black tracking-tighter mb-10">kilna</h1>
                        <p class="font-serif italic text-[56px] text-brand-black/60 tracking-tight leading-none mb-40">The art of imperfect beauty.</p>
                        <div class="flex justify-between w-full max-w-5xl text-[9px] font-mono uppercase tracking-[0.4em] opacity-30 border-t border-black/5 pt-10">
                            <div>Curated Ceramic Marketplace</div><div>Luxury Enterprise Identity</div><div>Digital Design System</div>
                        </div>
                    </div>
                </div>
            `, { hideMark: true, hideNum: true });

            // P02: İÇİNDEKİLER
            renderPage('İÇERİK', `
                <div class="col-span-12 flex flex-col justify-center">
                    <h2 class="font-serif italic text-7xl mb-12 border-b border-black pb-8">İçindekiler</h2>
                    <div class="grid grid-cols-2 gap-x-20 gap-y-6 font-mono text-[11px] uppercase tracking-[0.3em]">
                        <div class="space-y-6">
                            <div class="flex justify-between border-b border-gray-100 pb-2"><span>01. Manifesto & Vizyon</span><span>03</span></div>
                            <div class="flex justify-between border-b border-gray-100 pb-2"><span>02. Marka Özü (Luxury)</span><span>15</span></div>
                            <div class="flex justify-between border-b border-gray-100 pb-2"><span>03. Amblem: Tornanın Merkezi</span><span>28</span></div>
                            <div class="flex justify-between border-b border-gray-100 pb-2"><span>04. Logo Mühendisliği</span><span>42</span></div>
                        </div>
                        <div class="space-y-6">
                            <div class="flex justify-between border-b border-gray-100 pb-2"><span>05. Tipografi & Blog Sistemi</span><span>55</span></div>
                            <div class="flex justify-between border-b border-gray-100 pb-2"><span>06. Renk Teorisi & Materyal</span><span>68</span></div>
                            <div class="flex justify-between border-b border-gray-100 pb-2"><span>07. Ambalaj & Unboxing</span><span>82</span></div>
                            <div class="flex justify-between border-b border-gray-100 pb-2"><span>08. Dijital Deneyim (UI Kit)</span><span>95</span></div>
                        </div>
                    </div>
                </div>
            `);

            // P03: MANIFESTO
            renderPage('01. STRATEJİ', `
                <div class="col-span-12 grid grid-cols-12 gap-16 h-full items-center">
                    <div class="col-span-7 flex flex-col justify-center">
                        <span class="font-mono text-xs text-brand-clay tracking-[0.4em] mb-10 uppercase">Toprağın Hafızası</span>
                        <h2 class="font-serif italic text-8xl leading-[0.85] mb-12 tracking-tighter">Sabrın <br>Zanaatı.</h2>
                        <p class="font-sans text-xl leading-relaxed text-gray-500 max-w-xl">Kilna, modern dünyanın seri üretim çarklarına karşı bir duruştur. Her parça bir parmak izi, her sır bir hafıza taşır. Biz nesne değil, bir zanaatın sabrını satıyoruz.</p>
                    </div>
                    <div class="col-span-5">
                        ${aiImg("Extreme macro shot of raw ceramic texture, pottery dust, moody museum lighting, beige tones", "aspect-[4/5]")}
                    </div>
                </div>
            `);

            // P04: AMBLEM RASYONELİ (Screenshot Concept)
            renderPage('02. LOGO SİSTEMİ', `
                <div class="col-span-12 grid grid-cols-12 gap-16 h-full items-center">
                    <div class="col-span-5 bg-gray-50 aspect-square flex items-center justify-center p-20 rounded-3xl relative">
                        <div class="absolute inset-0 opacity-[0.1] scale-90">${emblemSvg("#121212", "100%")}</div>
                        <div class="z-10 scale-150">${emblemSvg("#121212", "200")}</div>
                    </div>
                    <div class="col-span-7 flex flex-col justify-center space-y-10">
                        <h3 class="font-sans font-bold text-5xl uppercase tracking-tighter text-brand-clay">Amblem: Tornanın Merkezi</h3>
                        <p class="font-serif italic text-3xl leading-relaxed">Merkez kaç kuvveti, toprağın yükselişi ve zanaatkarın odak noktası.</p>
                        <div class="grid grid-cols-2 gap-8 pt-10 border-t border-black/5">
                            <div>
                                <span class="font-mono text-[9px] uppercase tracking-widest text-gray-400">Konsept:</span>
                                <p class="text-xs mt-2 italic leading-relaxed">Fırın içindeki ısı dolaşımı ve tornanın merkezkaç kuvveti.</p>
                            </div>
                            <div>
                                <span class="font-mono text-[9px] uppercase tracking-widest text-gray-400">Matematik:</span>
                                <p class="text-xs mt-2 italic leading-relaxed">Halkalar arası oranlar Fibonacci diziliminden türetilmiştir.</p>
                            </div>
                        </div>
                    </div>
                </div>
            `);

            // P05: LOGO Engineering (X Space)
            renderPage('02. LOGO SİSTEMİ', `
                <div class="col-span-12 flex flex-col justify-center">
                    <h3 class="font-sans font-bold text-5xl mb-16 uppercase tracking-tighter">Logo Mühendisliği ve Güvenli Alan</h3>
                    <div class="relative bg-gray-50 h-80 rounded-3xl flex flex-col items-center justify-center overflow-hidden border border-dashed border-gray-200">
                         <div class="absolute inset-0 grid grid-cols-12 grid-rows-12 opacity-[0.03]">
                            ${Array(144).fill('<div class="border border-blue-400"></div>').join('')}
                         </div>
                         <div class="flex flex-col items-center scale-110">
                            <div class="mb-8 opacity-20">${emblemSvg("#121212", "100")}</div>
                            <h2 class="font-brand font-bold text-[120px] lowercase leading-none tracking-tighter">kilna</h2>
                         </div>
                         <div class="absolute bottom-6 left-10 font-mono text-[9px] text-brand-clay uppercase tracking-[0.3em]">Clear Space Rule: 1.5X / X = 'k' height</div>
                    </div>
                </div>
            `);

            // P06: TYPOGRAPHY
            renderPage('03. TİPOGRAFİ', `
                <div class="col-span-12 grid grid-cols-12 gap-12 h-full items-center">
                    <div class="col-span-6 space-y-16">
                        <div>
                            <span class="font-mono text-[10px] text-brand-clay uppercase tracking-[0.4em] mb-4 block">LOGO FONTU</span>
                            <h2 class="font-brand font-bold text-8xl lowercase">Comfortaa</h2>
                            <p class="text-[10px] font-mono mt-4 opacity-50 uppercase tracking-widest">Markanın Dijital İmzası</p>
                        </div>
                        <div>
                            <span class="font-mono text-[10px] text-brand-clay uppercase tracking-[0.4em] mb-4 block">EDİTORYAL BAŞLIK</span>
                            <h2 class="font-serif italic text-8xl">Cormorant</h2>
                            <p class="text-[10px] font-mono mt-4 opacity-50 uppercase tracking-widest">Lüks Anlatım ve Hikayeler</p>
                        </div>
                    </div>
                    <div class="col-span-6 bg-brand-black text-white p-20 rounded-3xl">
                         <span class="font-mono text-[10px] text-brand-clay uppercase tracking-[0.4em] mb-8 block">GÖVDE VE TEKNİK</span>
                         <div class="space-y-12">
                             <div>
                                <h3 class="font-sans font-extrabold text-5xl uppercase tracking-tighter">Manrope</h3>
                                <p class="text-xs opacity-50 mt-2 font-mono uppercase">UI / Readability / Information Architecture</p>
                             </div>
                             <div>
                                <h3 class="font-mono text-3xl uppercase tracking-widest">Space Mono</h3>
                                <p class="text-xs opacity-50 mt-2 font-mono uppercase">Technical Specs / SKU / Metadata</p>
                             </div>
                         </div>
                    </div>
                </div>
            `);

            // P07: BLOG HIERARCHY
            renderPage('03. TİPOGRAFİ', `
                <div class="col-span-12 flex flex-col justify-center">
                    <h3 class="font-serif italic text-6xl mb-12">Blog ve İçerik Hiyerarşisi</h3>
                    <div class="max-w-4xl mx-auto bg-white border border-black/5 shadow-2xl p-16 rounded-xl">
                        <div class="mb-10 text-center">
                            <span class="font-mono text-[9px] text-brand-clay uppercase tracking-[0.4em]">Atölye Notları • 12 ŞUBAT 2026</span>
                            <h2 class="font-serif italic text-6xl mt-4 leading-tight">Glaze Sanatında <br>Kusurlu Kontrol.</h2>
                        </div>
                        <div class="grid grid-cols-12 gap-10">
                            <div class="col-span-12">
                                ${aiImg("Macro ceramic studio photography, drying racks, soft natural window light", "aspect-video")}
                            </div>
                            <div class="col-span-8 space-y-6 text-lg leading-relaxed text-gray-600">
                                <p>Seramik sanatı, kontrol ve serbest bırakma arasındaki ince çizgide yürümektir. Her fırın açılışı bir sürprizdir.</p>
                                <h4 class="font-brand font-bold text-2xl lowercase text-brand-black">ateşin hafızası</h4>
                                <p>Cormorant Italic başlıklar ve Manrope Regular gövde metinleri arasındaki 1.6x satır aralığı standardımızdır.</p>
                            </div>
                            <div class="col-span-4 border-l border-black/5 pl-8 italic text-sm text-brand-clay flex items-end">
                                "Kusur, objenin ruhudur. Onu saklamayın, kutlayın."
                            </div>
                        </div>
                    </div>
                </div>
            `);

            // P08: PACKAGING LUXURY
            renderPage('04. AMBALAJ', `
                <div class="col-span-12 grid grid-cols-12 gap-16 h-full items-center">
                    <div class="col-span-6">
                        ${aiImg("High-end sustainable luxury ceramic packaging, debossed black logo on textured stone-white paper, gold foil seal", "aspect-square")}
                    </div>
                    <div class="col-span-6 space-y-12">
                        <h3 class="font-serif italic text-7xl leading-[0.8] mb-8">Açılış <br>Ritüeli.</h3>
                        <p class="text-lg opacity-60 leading-relaxed max-w-md">Paket açılışı, müşterinin markayla kurduğu en mahrem fiziksel temas anıdır. Varak baskılı pelur kağıdı ve kilden el yapımı bir mühür standardımızdır.</p>
                        <div class="grid grid-cols-2 gap-6 pt-10 border-t border-black/5">
                            <div class="p-6 bg-gray-50 rounded-2xl">
                                <span class="font-mono text-[8px] uppercase font-bold">Mühür</span>
                                <p class="text-[10px] mt-2 italic text-gray-500">Her kutu, torna merkezini simgeleyen bir mühürle kapatılır.</p>
                            </div>
                             <div class="p-6 bg-gray-50 rounded-2xl">
                                <span class="font-mono text-[8px] uppercase font-bold">Tekstür</span>
                                <p class="text-[10px] mt-2 italic text-gray-500">Ham keten dokulu beyaz kağıt ve siyah gofre baskı.</p>
                            </div>
                        </div>
                    </div>
                </div>
            `);

            // P09: DIGITAL UI SYSTEM
            renderPage('05. DİJİTAL', `
                <div class="col-span-12 flex flex-col justify-center">
                    <h3 class="font-serif italic text-6xl mb-12">Enterprise UI Tasarım Sistemi</h3>
                    <div class="grid grid-cols-3 gap-8">
                        <div class="p-10 border border-gray-100 rounded-3xl space-y-8">
                             <span class="font-mono text-[9px] text-brand-clay uppercase tracking-widest block">Design Tokens</span>
                             <div class="flex gap-4">
                                <div class="w-10 h-10 bg-brand-black rounded"></div>
                                <div class="w-10 h-10 bg-brand-clay rounded"></div>
                                <div class="w-10 h-10 bg-brand-paper border rounded"></div>
                             </div>
                             <div class="space-y-2 opacity-30 font-mono text-[8px] uppercase">
                                <span>$marka-siyah / #0D0D0D</span><br>
                                <span>$marka-kil / #C18C74</span>
                             </div>
                        </div>
                        <div class="p-10 border border-gray-100 rounded-3xl space-y-8">
                             <span class="font-mono text-[9px] text-brand-clay uppercase tracking-widest block">Component Library</span>
                             <div class="space-y-4">
                                <div class="bg-brand-black text-white p-4 text-center text-[10px] font-bold uppercase tracking-widest rounded-xl">Sepete Ekle</div>
                                <div class="border border-brand-black p-4 text-center text-[10px] font-bold uppercase tracking-widest rounded-xl">Koleksiyonu Gör</div>
                             </div>
                        </div>
                        <div class="p-10 border border-gray-100 rounded-3xl h-full flex items-center justify-center">
                             ${aiImg("Minimalist high-end ceramics website UI design on a dark mode screen", "aspect-video")}
                        </div>
                    </div>
                </div>
            `);

            // SIMULATED APPENDICES (TOTAL 100+ PAGES)
            for(let i=1; i<=88; i++) {
                if(i % 25 === 0) {
                     renderPage('EK REHBER', `
                        <div class="col-span-12 h-full flex flex-col justify-center items-center text-center -m-[25mm] p-40 bg-brand-black text-white relative">
                            <div class="absolute inset-0 opacity-[0.03] scale-150 pointer-events-none">${emblemSvg("#FFFFFF", "100%")}</div>
                            <span class="font-mono text-xs text-brand-clay mb-8 uppercase tracking-[0.6em]">PRODUCTION SPECS / VOL. ${Math.floor(i/25)}</span>
                            <h2 class="font-serif italic text-8xl mb-6">Uygulama <br>Endeksi.</h2>
                            <div class="w-16 h-px bg-brand-clay mb-12"></div>
                            <div class="grid grid-cols-4 gap-4 w-full opacity-10 px-20">
                                ${Array(8).fill('<div class="h-1 bg-gray-500 rounded-full"></div>').join('')}
                            </div>
                        </div>
                    `, { hideMark: true, hideNum: true });
                } else {
                    renderPage('ŞARTNAME', `
                        <div class="col-span-12 h-full">
                            <div class="flex justify-between items-end border-b border-black pb-4 mb-10">
                                <h3 class="font-sans font-bold text-[10px] uppercase tracking-[0.3em] text-brand-clay">Spec No: K-UX-${4000 + i}</h3>
                                <span class="font-mono text-[7px] opacity-30 uppercase tracking-widest">Global Kurumsal Standart</span>
                            </div>
                            <div class="grid grid-cols-12 gap-16 h-[100mm]">
                                <div class="col-span-7 flex flex-col justify-between">
                                    <h4 class="font-serif italic text-5xl leading-tight">Uygulama: ${['E-Posta İmzası', 'Araç Giydirme', 'Mağaza Tabelası', 'Personel Kartı', 'Sosyal Medya Motion'][i % 5]}</h4>
                                    <div class="bg-gray-100 rounded-3xl p-10 h-48 flex items-center justify-center relative overflow-hidden group">
                                         <div class="absolute inset-0 opacity-[0.03] scale-150">${emblemSvg()}</div>
                                         <div class="font-mono text-[6px] opacity-20 uppercase tracking-widest text-center px-10 leading-relaxed italic">TEKNİK TASLAK MİMARİSİ VE <br>GRID TABANLI KOMPOZİSYON STANDARTI</div>
                                    </div>
                                    <p class="text-[10px] text-gray-400 leading-relaxed font-sans uppercase tracking-widest italic opacity-50">Lüks segment üretim standartları gereği tüm vektörler %100 ölçeklenebilir olmalıdır.</p>
                                </div>
                                <div class="col-span-5 flex flex-col gap-6">
                                    ${aiImg("Production detail of " + ['branding stationery', 'delivery vehicle wrap', 'exterior signage lighting', 'staff identity card', 'motion graphic still'][i % 5], "aspect-square")}
                                    <div class="bg-brand-paper p-8 rounded-2xl border border-gray-100 flex-1 flex flex-col justify-center">
                                         <span class="font-mono text-[8px] font-bold uppercase block mb-2 text-brand-clay tracking-[0.3em]">YÖNETİŞİM:</span>
                                         <p class="text-[10px] italic text-gray-500 leading-relaxed italic">Tornanın Merkezkaç yasasına sadık kalarak, her tasarım her zaman merkezden dışa doğru genişlemelidir.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `, { hideMark: (i > 5) });
                }
            }

            // P100: THE END
            renderPage('SON', `
                <div class="col-span-12 h-full flex flex-col items-center justify-center text-center -m-[25mm] bg-brand-black text-white relative">
                    <div class="absolute top-[25mm] opacity-5 scale-150">${emblemSvg("#FFFFFF", "400")}</div>
                    <h2 class="font-brand font-bold text-[180px] lowercase mb-12 tracking-tighter">kilna</h2>
                    <div class="w-32 h-px bg-brand-clay mb-12"></div>
                    <p class="font-mono text-sm tracking-[1.2em] text-gray-500 uppercase">Her şey merkezden başlar.</p>
                    <div class="mt-60 text-[10px] font-mono text-gray-700 uppercase tracking-widest opacity-40">© 2026 KILNA GLOBAL BRANDING GOVERNANCE. TÜM HAKLARI SAKLIDIR.</div>
                </div>
            `, { hideMark: true, hideNum: true, dark: true });
        };

        // --- PRODUCTION ENGINES ---

        async function exportPDF() {
            const element = document.getElementById('book-container');
            const btn = document.getElementById('btn-pdf');
            if (!btn || !element) return;

            btn.innerText = "YAZDIRILIYOR...";
            btn.disabled = true;

            const opt = {
                margin: 0,
                filename: 'kilna-16-9-brand-bible-v3.pdf',
                image: { type: 'jpeg', quality: 1.0 },
                html2canvas: { scale: 1.2, useCORS: true, logging: false },
                jsPDF: { unit: 'mm', format: [320, 180], orientation: 'landscape' },
                pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
            };

            try {
                await html2pdf().set(opt).from(element).save();
                btn.innerText = "İNDİRİLDİ";
            } catch (err) {
                console.error(err);
                btn.innerText = "HATA";
            } finally {
                setTimeout(() => { btn.innerText = "PDF İNDİR"; btn.disabled = false; }, 3000);
            }
        }

        async function fetchWithRetry(prompt, maxRetries = 5) {
            const isLogoRef = !!logoBase64;
            const model = isLogoRef ? 'gemini-2.5-flash-image-preview' : 'imagen-4.0-generate-001';
            const statusIndicator = document.getElementById('progress-indicator');
            statusIndicator.style.opacity = "1";

            const enhancedPrompt = isLogoRef 
                ? `Yüklenen logoyu resmi marka logosu olarak kullan. Şu objenin lüks bir ürün çekimini yap: ${prompt}. Logoyu objenin yüzeyine veya arka plana, profesyonel bir marka uygulaması (gofre, baskı veya oyma) gibi kusursuzca yerleştir. Stil: Minimalist lüks, wabi-sabi estetiği, müze aydınlatması, yüksek kaliteli doku detayları.`
                : prompt;

            for (let i = 0; i < maxRetries; i++) {
                try {
                    let response;
                    if (isLogoRef) {
                        const payload = {
                            contents: [{ parts: [{ text: enhancedPrompt }, { inlineData: { mimeType: "image/png", data: logoBase64 } }] }],
                            generationConfig: { responseModalities: ['TEXT', 'IMAGE'] }
                        };
                        response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`, {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify(payload),
                        });
                    } else {
                        response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${model}:predict?key=${apiKey}`, {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({ instances: [{ prompt: enhancedPrompt }], parameters: { sampleCount: 1 } }),
                        });
                    }
                    if (response.ok) return await response.json();
                    if (response.status === 429) await new Promise(r => setTimeout(r, Math.pow(2, i) * 1000));
                } catch (e) {
                    if (i === maxRetries - 1) return null;
                    await new Promise(r => setTimeout(r, Math.pow(2, i) * 1000));
                }
            }
            return null;
        }

        async function startGeneration() {
            const btn = document.getElementById('btn-generate');
            const spinner = document.getElementById('gen-spinner');
            const text = document.getElementById('gen-text');
            const progressBar = document.getElementById('progress-bar');
            const progressVal = document.getElementById('progress-val');
            const images = document.querySelectorAll('img[data-prompt]');
            
            btn.disabled = true;
            spinner.classList.remove('hidden');
            text.innerText = logoBase64 ? "LOGO REFERANS ALINIYOR..." : "ÜRETİLİYOR...";

            let completed = 0;
            for (const img of images) {
                const prompt = img.getAttribute('data-prompt');
                try {
                    const data = await fetchWithRetry(prompt);
                    let base64 = null;
                    if (logoBase64) {
                        base64 = data.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;
                    } else {
                        base64 = data?.predictions?.[0]?.bytesBase64Encoded;
                    }
                    if (base64) {
                        img.src = `data:image/png;base64,${base64}`;
                        img.onload = () => {
                            img.classList.add('loaded');
                            if (img.previousElementSibling) img.previousElementSibling.style.display = 'none';
                        };
                    }
                } catch (e) { console.warn(e); }
                completed++;
                const perc = Math.floor((completed / images.length) * 100);
                progressBar.style.width = `${perc}%`;
                progressVal.innerText = `%${perc}`;
            }

            spinner.classList.add('hidden');
            text.innerText = "ÜRETİM TAMAMLANDI";
            btn.disabled = false;
        }

        window.onload = initPresentation;
    </script>
</body>
</html>
